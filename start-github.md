# Проверка наличия SSH-ключа

Прежде чем генерировать SSH-ключи, убедитесь, что у вас их ещё нет. По умолчанию директория с SSH-ключами находится в домашней директории пользователя. Перейдите в неё.

```bash
$ cd ~ # перешли в домашнюю директорию 
```

Обычно SSH-ключи находятся в директории `~/.ssh/`. Проверить наличие этой директории и файлов в ней можно с помощью следующей команды.
Скопировать кодBASH

```bash
$ ls -la .ssh/ # вывели список созданных ключей 
```

Если папка пустая или её нет, всё в порядке. Если есть файлы с похожими названиями, SSH-ключи уже создавались:

• id_dsa.pub;
• id_ecdsa.pub;
• id_ed25519.pub;
• id_rsa.pub.

Если вы не создавали эти файлы, удалите их все.

**Инструкция по генерации SSH-ключа**

Для генерации SSH-пары можно использовать программу ssh-keygen. Откройте терминал и введите следующую команду.

Используйте электронную почту, к которой привязан ваш GitHub-аккаунт.

```bash
$ ssh-keygen -t rsa -b 4096 -C "электронная почта, к которой привязан ваш аккаунт на GitHub" 
> Generating public/private rsa key pair. # сгенерированы публичный и приватный ключи 
```

Укажите место хранения ключей. Простой вариант — сделать домашний каталог пользователя путём по умолчанию. Для этого нажмите Enter.

```
> Enter a file in which to save the key (/Users/you/.ssh/id_rsa): [Press enter] 
```

Теперь в указанной директории появится пара ключей.

Программа запросит кодовую фразу (англ. passphrase) для доступа к SSH-ключу. Вы можете оставить поле пустым. Для этого нажмите Enter, а затем ещё раз Enter для подтверждения.

```
> Enter passphrase (empty for no passphrase): [Type a passphrase]
> Enter same passphrase again: [Type passphrase again] 
```

Готово! Теперь осталось проверить, что ключи действительно сгенерировались. Для этого вызовите эту команду.
Скопировать кодBASH

```bash
$ ls -a ~/.ssh 
```

На экране должны появиться два файла — один с расширением `.pub`, другой — без. Файл в `.pub` — публичный, им можно делиться с веб-сайтами или коллегами. Файл без расширения `.pub` — приватный. Ни в коем случае не передавайте его никому!  

# Связывание SSH-ключа и GitHub-аккаунта

нужно распечатать файл на экран с помощью `cat ~/.ssh/id_rsa.pub` и скопировать его.

1. Перейдите на GitHub и выберите пункт `Settings` (англ. «настройки») в меню аккаунта (справа вверху).
2. В меню слева нажмите на пункт `SSH and GPG keys`.
3. В открывшейся вкладке выберите New SSH key (англ. «новый SSH-ключ»).
4. В поле Title (англ. «заголовок») напишите название ключа. Например, Personal key (англ. «личный ключ»).
5. В поле Key type (англ. «тип ключа») должно быть Authentication Key (англ. «ключ аутентификации»).
6. В поле Key скопируйте ваш ключ из буфера обмена.
7. Нажмите на кнопку Add SSH key (англ. «добавить SSH-ключ»).

## Добавление ключа в ssh-агент

> Надо разобраться, т.к. без этой операции вылетает ошибка
> `git@github.com: Permission denied (publickey).`

Запустите агент SSH в фоновом режиме.

```bash
$ eval "$(ssh-agent -s)"
> Agent pid 00000
```

В зависимости от среды может потребоваться использовать другую команду. Например, вам может потребоваться доступ с правами root, для чего необходимо выполнить `sudo -s -H` перед запуском агента SSH. Может также потребоваться использовать exec ssh-agent bashили exec ssh-agent zsh для запуска агента SSH.

Найдите и запишите отпечаток открытого ключа.

```bash
$ ssh-add ~/.ssh/github.com
Identity added: /home/lyzlov/.ssh/github.com (miike71@gmail.com)
```

Ключи SSH на GitHub должны совпадать с теми же ключами на компьютере.

## Проверка

Проверьте правильность ключа с помощью следующей команды.

```bash
$ ssh -p22 -T git@github.com 
Hi miike71! You've successfully authenticated, but GitHub does not provide shell access.
```

Если это первый раз, когда вы используете Git, чтобы поделиться проектом на GitHub, появится похожее предупреждение.

```
The authenticity of host 'github.com (140.82.121.4)' can't be established. ED25519 key fingerprint is SHA256:+DiY3wvvV6TuJJhbpZisF/zLDA0zPMSvHdkr4UvCOqU. This key is not known by any other names. Are you sure you want to continue connecting (yes/no/[fingerprint])? 
```

Это предупреждение сообщает, что вы никогда не соединялись с сервером GitHub. Поэтому Git не может гарантировать, что сервер является тем, за кого он себя выдаёт.
Для подтверждения подлинности сервер генерирует и публикует ключи SHA256. Вы можете проверить ключи GitHub по этой ссылке. Если ключ в предупреждении совпадает с тем, что вы видите на сайте, значит, сервер является действительным. Введите yes, чтобы продолжить. Вы увидите приветствие на экране.


## Отправка локального git на GitHub

```bash
# Выбираем название ветки
git branch -M master
# запускаум ssh-agent в фоновом режима
$ eval "$(ssh-agent -s)"
# добавляем отпечаток ключа в агент
$ ssh-add ~/.ssh/github.com
# добавляем `git-help.git`
git remote add origin git@github.com:miike71/git-help.git
# отправляем 
git push -u origin master
```

> **Внимание** В последствии, для ЭТОГО репозитория, молжно делать пуши без дополнительных параметров

```bash
# ДЛЯ РЕПОЗИТОРИЯ git-help.git
$ cd path/to/git-help
# подготавливаем файлы для `git commit`
$ git add .
# фиксируем изменения
$ git commit -m "коментарий"
# запускаум ssh-agent в фоновом режима
$ eval "$(ssh-agent -s)"
# добавляем отпечаток ключа в агент
$ ssh-add ~/.ssh/github.com
# и потом отправка на GitHub
$ git push
```


### Если ssh порт у компа другой (отличается от 22) то:

(Такими-же командами можно переключиться с SSH на URL)

```bash
# удаление уже добавленного пути репозитория
$ git remote remove origin 
# добавление нового пути
$ git remote add origin ssh://git@github.com:22/miike71/git-help.git
# добавление нового пути
$ git push -u origin master
```

**Если при использовании команды**:

```bash
$ git push -u origin master
```

Возникает ошибка: `error: src refspec main does not match any`, то добавляем `README.md`, а потом `git commit`:

```bash
$ git add .
$ git commit -m "added README.md"
$ git branch -M master
# и потом 
# запускаум ssh-agent в фоновом режима
$ eval "$(ssh-agent -s)"
# добавляем отпечаток ключа в агент
$ ssh-add ~/.ssh/github.com
# отправка на GitHub
$ git push -u origin master
# Если команда приведёт к ошибке, попробуйте заменить main на master.
```


